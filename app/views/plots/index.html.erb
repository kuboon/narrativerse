<main class="page">
  <section class="grid">
    <div class="grid-header">
      <h1>プロット</h1>
      <% if policy(Plot).create? %>
        <%= link_to "プロット作成", new_plot_path, class: "btn primary" %>
      <% end %>
    </div>
    <%= form_with url: plots_path, method: :get, class: "filter-bar" do |form| %>
      <div class="field">
        <%= form.label :q, "検索" %>
        <%= form.text_field :q, value: @query, placeholder: "タイトル / 概要" %>
      </div>
      <div class="actions">
        <%= form.submit "絞り込む", class: "btn ghost" %>
      </div>
    <% end %>
    <div class="cards">
      <% @plots.each do |plot| %>
        <article class="card">
          <h3><%= plot.title %></h3>
            <div class="detail-meta">
              <div>
                <span class="meta-label">作成者</span>
                <span><%= plot.user.name %></span>
              </div>
            </div>
            <p><%= plot.summary.presence || "まだ概要がありません。" %></p>
            <div class="card-actions">
              <%= link_to "詳細", plot_path(plot), class: "text-link" %>
              <% if plot.plot_scene_links.any? %>
              <%= link_to "読む", reader_path(plot), class: "text-link" %>
              <% end %>
            </div>
        </article>
      <% end %>
    </div>
  </section>
</main>
